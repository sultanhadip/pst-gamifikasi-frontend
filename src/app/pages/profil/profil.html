<div class="page-container">
    <!-- Main Content -->
    <div class="main-content" *ngIf="!showAllAchievements() && userProfile()">
        <!-- Profile Header Section -->
        <div class="profile-card">
            <div class="profile-banner">
                <div class="banner-circle">
                    <img *ngIf="userProfile().image" [src]="userProfile().image" class="avatar-img-profil">
                    <div *ngIf="!userProfile().image" class="avatar-dragon-wrapper">{{ userProfile().name.charAt(0) }}</div>
                </div>
            </div>

            <div class="profile-header-content">
                <div class="user-main-info">
                    <h2>{{ userProfile().name }}</h2>
                    <p class="user-role">{{ userProfile().role }}</p>
                    <p class="user-join">Bergabung {{ userProfile().createdAt | date:'MMMM yyyy' }}</p>
                    <button class="btn-gelar" (click)="toggleTitlesModal()">PILIH GELAR</button>
                </div>

                <div class="profile-actions">
                    <button class="btn-action-green">
                        <span class="icon">üìù</span> UBAH PROFIL
                    </button>
                    <button class="btn-action-green">
                        <span class="icon">üîë</span> TAMBAH PASSWORD
                    </button>
                    <button class="btn-action-green">
                        <span class="icon">‚öôÔ∏è</span> PENGATURAN
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics Section -->
        <div class="section-container" *ngIf="userProgress()">
            <h3>Statistik</h3>
            <div class="stats-grid-2">
                <div class="stat-mini-card">
                    <div class="stat-icon-bg">üî•</div>
                    <div class="stat-text">
                        <div class="stat-value">{{ userProfile().streaks }}</div>
                        <div class="stat-label">Kehadiran beruntun</div>
                    </div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-icon-bg">‚ö°</div>
                    <div class="stat-text">
                        <div class="stat-value">{{ userProgress().points }}</div>
                        <div class="stat-label">Total Poin</div>
                    </div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-icon-bg">üìë</div>
                    <div class="stat-text">
                        <div class="stat-value">{{ userProgress().publications }}</div>
                        <div class="stat-label">Publikasi dibaca</div>
                    </div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-icon-bg">üìÅ</div>
                    <div class="stat-text">
                        <div class="stat-value">{{ userProgress().press }}</div>
                        <div class="stat-label">BRS dibaca</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements Section -->
        <div class="section-container">
            <div class="section-header">
                <h3>Pencapaian</h3>
                <button class="btn-link" (click)="toggleAchievements()">LIHAT SEMUA</button>
            </div>

            <div *ngIf="achievements().length > 0" class="achievement-preview-card">
                <div class="achievement-icon-wrapper shield">üõ°Ô∏è</div>
                <div class="achievement-content">
                    <h4>{{ achievements()[0].name }}</h4>
                    <p>{{ achievements()[0].description }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- All Achievements View -->
    <div class="main-content" *ngIf="showAllAchievements()">
        <div class="all-achievements-header">
            <button class="btn-back" (click)="toggleAchievements()">‚Üê</button>
            <h2 class="page-title-center">Semua Pencapaian</h2>
        </div>

        <div class="achievements-list">
            <div class="achievement-full-card" *ngFor="let a of achievements()">
                <div class="card-top">
                    <div class="achievement-badge shield-blue">üõ°Ô∏è</div>
                    <div class="achievement-info-main">
                        <div class="title-row">
                            <h4>{{ a.name }}</h4>
                        </div>
                        <p>{{ a.description }}</p>
                        <div class="meta-row">
                            <span class="meta-reward">Reward: {{ a.rewardXp }} points</span>
                            <span class="meta-reward">Diamonds: {{ a.rewardDiamonds }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Widgets -->
    <div class="right-widgets">
        <app-stats-ribbon></app-stats-ribbon>
        <app-daily-mission-widget></app-daily-mission-widget>
        <app-search-user-widget></app-search-user-widget>
    </div>

    <!-- Titles Modal -->
    <div class="modal-overlay" *ngIf="showTitlesModal()">
        <div class="modal-content title-modal">
            <div class="modal-header">
                <h3>Pilih Gelar</h3>
                <button class="btn-close" (click)="toggleTitlesModal()">√ó</button>
            </div>
            <div class="titles-list">
                <div class="title-item" *ngFor="let t of titles()" [class.active]="t.isActive" (click)="onSetTitle(t.title.id)">
                    <div class="title-info">
                        <span class="title-name">{{ t.title.name }}</span>
                        <span class="title-desc">{{ t.title.description }}</span>
                    </div>
                    <span class="active-badge" *ngIf="t.isActive">AKTIF</span>
                </div>
                <div *ngIf="titles().length === 0" class="empty-state">
                    Belum ada gelar yang terbuka. Selesaikan kuis untuk mendapatkan gelar!
                </div>
            </div>
        </div>
    </div>
</div>