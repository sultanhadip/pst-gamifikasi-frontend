<div class="admin-layout">
    <!-- ADMIN SIDEBAR -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="pie-chart-icon">
                    <div class="slice-red"></div>
                    <div class="slice-yellow"></div>
                </div>
                <div class="logo-text-group">
                    <span class="logo-main">StatLegend</span>
                    <span class="logo-sub">ADMIN PANEL</span>
                </div>
            </div>
        </div>

        <nav class="admin-nav">
            <button class="nav-item" [class.active]="activeTab() === 'content'" (click)="setActiveTab('content')">
                <span class="icon">üìö</span>
                <span class="label">LEARN CONTENT</span>
            </button>
            <button class="nav-item" [class.active]="activeTab() === 'users'" (click)="setActiveTab('users')">
                <span class="icon">üë•</span>
                <span class="label">USERS</span>
            </button>
            <button class="nav-item" [class.active]="activeTab() === 'user-detail'"
                (click)="setActiveTab('user-detail')">
                <span class="icon">üìÑ</span>
                <span class="label">USER DETAIL</span>
            </button>
            <a routerLink="/" class="nav-item">
                <span class="icon">üè†</span>
                <span class="label">BACK TO APP</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn-signout">
                <div class="signout-icon-wrapper">
                    <!-- Custom SVG Exit Icon similar to screenshot -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                </div>
                <span class="label">SIGN OUT</span>
            </button>
        </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="admin-main">

        <!-- VIEW: CONTENT MANAGEMENT -->
        <div *ngIf="activeTab() === 'content'" class="admin-view">
            <header class="view-header">
                <div class="header-breadcrumbs">
                    <h1 [class.clickable]="contentView() !== 'courses'" (click)="backToCourses()">Learning Content Management</h1>
                    <span *ngIf="contentView() !== 'courses'" class="sep">/</span>
                    <h1 *ngIf="selectedCourse()" [class.clickable]="contentView() === 'lessons'" (click)="backToUnits()">{{ selectedCourse().title }}</h1>
                    <span *ngIf="contentView() === 'lessons'" class="sep">/</span>
                    <h1 *ngIf="selectedUnit()">{{ selectedUnit().title }}</h1>
                </div>
            </header>

            <!-- COURSES VIEW -->
            <section *ngIf="contentView() === 'courses'" class="view-section">
                <div class="section-header">
                    <h2>Courses</h2>
                    <div class="section-actions">
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" placeholder="Search courses...">
                        </div>
                        <button class="btn-add" (click)="openAddModal('course')">
                            <span class="plus">‚äï</span> ADD COURSE
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Image</th>
                                <th>Title</th>
                                <th class="text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let course of courses()">
                                <td>{{course.id}}</td>
                                <td class="td-image">
                                    <img *ngIf="course.imageSrc" [src]="course.imageSrc" class="table-img-real">
                                    <span *ngIf="!course.imageSrc" class="table-img">üìö</span>
                                </td>
                                <td>{{course.title}}</td>
                                <td class="text-right">
                                    <button class="btn-action-sm" (click)="viewUnits(course)">MANAGE UNITS</button>
                                    <button class="btn-action-sm" (click)="openEditModal('course', course)">EDIT</button>
                                    <button class="btn-action-sm red" (click)="onDelete('course', course.id)">DELETE</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- UNITS VIEW -->
            <section *ngIf="contentView() === 'units'" class="view-section">
                <div class="section-header">
                    <h2>Units in {{ selectedCourse()?.title }}</h2>
                    <div class="section-actions">
                        <button class="btn-add" (click)="openAddModal('unit')">
                            <span class="plus">‚äï</span> ADD UNIT
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Order</th>
                                <th>Title</th>
                                <th>Unlock Cost</th>
                                <th class="text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let unit of units()">
                                <td>{{unit.orderIndex}}</td>
                                <td>{{unit.title}}</td>
                                <td>{{unit.unlockCost}} üíé</td>
                                <td class="text-right">
                                    <button class="btn-action-sm" (click)="viewLessons(unit)">MANAGE LESSONS</button>
                                    <button class="btn-action-sm" (click)="openEditModal('unit', unit)">EDIT</button>
                                    <button class="btn-action-sm red" (click)="onDelete('unit', unit.id)">DELETE</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- LESSONS VIEW -->
            <section *ngIf="contentView() === 'lessons'" class="view-section">
                <div class="section-header">
                    <h2>Lessons in {{ selectedUnit()?.title }}</h2>
                    <div class="section-actions">
                        <button class="btn-add" (click)="openAddModal('lesson')">
                            <span class="plus">‚äï</span> ADD LESSON
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Order</th>
                                <th>Title</th>
                                <th class="text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let lesson of lessons()">
                                <td>{{lesson.orderIndex}}</td>
                                <td>{{lesson.title}}</td>
                                <td class="text-right">
                                    <button class="btn-action-sm" (click)="openEditModal('lesson', lesson)">EDIT</button>
                                    <button class="btn-action-sm red" (click)="onDelete('lesson', lesson.id)">DELETE</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- MODAL FOR ADD/EDIT -->
        <div class="modal-backdrop" *ngIf="showModal()">
            <div class="admin-modal">
                <div class="modal-header">
                    <h3>{{ modalMode() === 'add' ? 'Add' : 'Edit' }} {{ modalType() | titlecase }}</h3>
                    <button class="btn-close" (click)="closeModal()">√ó</button>
                </div>
                <form [formGroup]="adminForm" (ngSubmit)="onSubmit()">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" formControlName="title" placeholder="Enter title">
                        </div>
                        
                        <div class="form-group" *ngIf="modalType() !== 'lesson'">
                            <label>Description</label>
                            <textarea formControlName="description" placeholder="Enter description"></textarea>
                        </div>

                        <div class="form-group" *ngIf="modalType() === 'course'">
                            <label>Image URL</label>
                            <input type="text" formControlName="imageSrc" placeholder="e.g. /assets/course.png">
                        </div>

                        <div class="form-group" *ngIf="modalType() === 'unit'">
                            <label>Unlock Cost (Diamonds)</label>
                            <input type="number" formControlName="unlockCost">
                        </div>

                        <div class="form-group" *ngIf="modalType() === 'lesson'">
                            <label>Content (Text/Markdown)</label>
                            <textarea formControlName="content" rows="6" placeholder="Enter lesson content"></textarea>
                        </div>

                        <div class="form-group" *ngIf="modalType() !== 'course'">
                            <label>Order Index</label>
                            <input type="number" formControlName="orderIndex">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>
                        <button type="submit" class="btn-save" [disabled]="adminForm.invalid">
                            {{ modalMode() === 'add' ? 'Save' : 'Update' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- VIEW: USER MANAGEMENT -->
        <div *ngIf="activeTab() === 'users'" class="admin-view">
            <header class="view-header">
                <h1>User Management</h1>
            </header>

            <section class="view-section">
                <div class="section-header">
                    <h2>All Users ({{ allUsers().length }})</h2>
                </div>
                <div class="search-row">
                    <div class="search-box wide">
                        <span class="search-icon">üîç</span>
                        <input type="text" placeholder="Search users by name, email, username...">
                    </div>
                </div>
                <div class="table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Avatar</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Username</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th class="text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let user of allUsers()">
                                <td>
                                    <img *ngIf="user.image" [src]="user.image" class="avatar-sm">
                                    <span *ngIf="!user.image" class="avatar-sm">üë§</span>
                                </td>
                                <td><strong>{{user.name}}</strong></td>
                                <td>{{user.email}}</td>
                                <td>{{user.username}}</td>
                                <td><span class="badge" [class.badge-admin]="user.role === 'ADMIN'" [class.badge-user]="user.role !== 'ADMIN'">{{user.role}}</span></td>
                                <td>
                                    <span [class.status-active]="!user.banned" [class.status-banned]="user.banned">
                                        {{ user.banned ? 'Banned' : 'Active' }}
                                    </span>
                                </td>
                                <td class="text-right">
                                    <button class="btn-action-sm" (click)="viewUserDetail(user)">VIEW</button>
                                    <button *ngIf="!user.banned" class="btn-action-sm red" (click)="onBanUser(user.id)">BAN</button>
                                    <button *ngIf="user.banned" class="btn-action-sm green" (click)="onUnbanUser(user.id)">UNBAN</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- VIEW: USER DETAIL -->
        <div *ngIf="activeTab() === 'user-detail' && selectedUser()" class="admin-view">
            <header class="view-header">
                <button class="btn-back-inline" (click)="setActiveTab('users')">‚Üê Back</button>
                <h1>User Detail: {{ selectedUser().username }}</h1>
            </header>

            <div class="detail-card">
                <div class="detail-top">
                    <div class="detail-avatar-large">
                        <img *ngIf="selectedUser().image" [src]="selectedUser().image">
                        <span *ngIf="!selectedUser().image">üë§</span>
                    </div>
                    <div class="detail-title-group">
                        <h2>{{selectedUser().name}}</h2>
                        <span class="badge" [class.badge-admin]="selectedUser().role === 'ADMIN'">{{selectedUser().role}}</span>
                    </div>
                </div>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">ID:</span>
                        <span class="detail-value text-secondary">{{selectedUser().id}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Username:</span>
                        <span class="detail-value">{{selectedUser().username}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value">{{selectedUser().email}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Level:</span>
                        <span class="detail-value">{{selectedUser().levelId}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Diamonds:</span>
                        <span class="detail-value">{{selectedUser().diamonds}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Streaks:</span>
                        <span class="detail-value">{{selectedUser().streaks}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value" [class.text-danger]="selectedUser().banned">
                            {{ selectedUser().banned ? 'Banned' : 'Active' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>